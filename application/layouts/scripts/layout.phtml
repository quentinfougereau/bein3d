<?php echo $this->doctype() ?>
<html>
    <head>
        <?php require $this->layout()->chemin.'/public/requires/head-import.php'; ?>
    </head>
    <body fullbleed vertical layout unresolved>
        <input type="hidden" value="<?php echo $this->layout()->chemin ?>" id="chemin">
        <input type="hidden" value="<?php echo $this->layout()->menu ?>" id="menu">
        <script>
            document.addEventListener('polymer-ready', function () {
                var action = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName() ?>';
                document.querySelector('submenu-mainpage').menu = '<?php echo $this->layout()->menu ?>';
                document.querySelector('submenu-mainpage').chemin = '<?php echo $this->layout()->chemin ?>';
                document.querySelector('submenu-mainpage').menusub = action;

                var navicon = document.getElementById('navicon');
                var drawerPanel = document.getElementById('drawerPanel');
                navicon.addEventListener('click', function () {
                    drawerPanel.togglePanel();
                });
            });
        </script>

    <paper-drawer-panel  id="drawerPanel">
        <!--DRAWER-->
        <paper-header-panel drawer>
            <paper-toolbar class="medium">
                <h2 id="left-title">
                    <a href="<?php
                    echo $this->url(array('controller' => 'Index',
                        'action' => 'index'))
                    ?>">BEin3D</a>
                </h2>
            </paper-toolbar>
            <div id="drawer-content">
                <client-drawer-card></client-drawer-card>
                <social-drawer-card></social-drawer-card>
            </div>      
        </paper-header-panel>

        <!-- MAIN -->
        <paper-header-panel main >

            <paper-toolbar class="medium" id="barre2">
                <!-- TOP TOOLBAR -->
                <paper-icon-button id="navicon" icon="menu"></paper-icon-button>
                <menu-toolbar-hsds></menu-toolbar-hsds>

                    <paper-rechercher></paper-rechercher>
                    <paper-icon-button id="recherche" icon='search' on-tap='{{toggleDialog1}}' onclick="search()"></paper-icon-button>

                    <paper-dialog  class='size-position'>     <?php include_once("../application/views/scripts/Rechercher/index.phtml"); ?></paper-dialog>
                    <?php include_once("../application/views/scripts/panier/index.phtml"); ?>


                    <input type="hidden" id="nbproduit" value="0"><p id="panier"></p>
                    <?php if (!isset($_SESSION['email'])) { ?>
                        <paper-button  id="connexion-button" label="CONNEXION"  on-tap="{{toggleDialog1}}" ></paper-button>
                        <paper-dialog heading="CONNEXION" class="size-position" >
                            <core-form-connexion></core-form-connexion>
                        </paper-dialog>
                        <paper-button  id="inscription-button" label="INSCRIPTION" onclick="toggleDialog('paper-dialog-transition-center')" ></paper-button>

                        <paper-dialog heading="Inscription" transition="paper-dialog-transition-center">
                            <core-form-inscription>           
                            </core-form-inscription>
                        </paper-dialog>
                        <?php
                    } else {

                        if ($_SESSION["role"] == "user") {
                            echo "<a href=" . $this->url(array('controller' => 'profil',
                                'action' => 'index')) . "/><core-icon icon='account-circle'></core-icon></a>";
                        } else {
                            echo "<a href =" . $this->url(array('controller' => 'backoffice_connexion', 'action' => 'index')) . ">Backoffice</a>";
                            echo "<a href=" . $this->url(array('controller' => 'profil',
                                'action' => 'index')) . "/><core-icon icon='account-circle'></core-icon></a>";
                        }

                        echo "<p>" . $_SESSION['email'] . "</p>";
                        ?>
                        <core-icon-button icon="more-vert"></core-icon-button>

                        <?php
                        echo "<a href =" . $this->url(array('controller' => 'deconnexion', 'action' => 'index')) . ">Deconnexion</a>";
                    }
                    ?>
                       
            </paper-toolbar>

            <submenu-mainpage></submenu-mainpage>
            <?php
            echo $this->layout()->content;
            ?>  
            </core-header-panel>
    </paper-drawer-panel>
</body>
<script type="text/javascript">
    //
    //    function addName() {
    //        var recup = document.querySelectorAll("hello-john-doe")[0];
    //        document.querySelector("buddies-list").buddies.push({name: recup.name});
    //    }
    //    ;
    function toggleDialog(transition) {
        var dialog = document.querySelector('paper-dialog[transition=' + transition + ']');
        dialog.toggle();
    }
    ;

    var MonTableau = new Array();


    var scope = document.querySelector('template[is=auto-binding]');

    scope.toggleDialog1 = function (e) {
//                if (e.target.localName != 'paper-button') {
//                    return;
//                }
        var d = e.target.nextElementSibling;
        if (!d) {
            return;
        }
        $("#resultrecherche").load("http://localhost/bein3d/public/Rechercher/refresh");
        $.ajaxSetup({cache: false});
        d.toggle();

    };
</script>
</html>